-- ERB template to initialize edge set for pagerank calculation
edges     = LOAD '<%= edge_set %>' AS (v1:chararray, v2:chararray);
edges_rhs = FOREACH edges GENERATE v2;
rhs_uniq  = DISTINCT edges_rhs;
edges_cog = COGROUP edges BY v1, rhs_uniq BY v2;
adj_list  = FOREACH edges_cog {
              -- if network.node_b is empty there are no out links, set to dummy value
              vertices = (IsEmpty(edges.v2) ? {('dummy')} : edges.v2);
              GENERATE
                group                AS v,
                <%= initial_rank %>f AS rank,
                vertices             AS out_links
              ;
            };

STORE adj_list INTO '<%= outputs.first %>';
